<script type="text/javascript">
(function() {

	var direction, scroll_interval, margin, sticky_bar_height, box_height;
	var anchor = 0;
	var max_clicks = 0;

	jQuery(document).ready(function() {

		/* Toggle menus */
		jQuery("div.nav-wrapper > ul > li").click(function(){
			jQuery(this).children("ul.menu").toggle();
		});
		/* Open and close lightbox */
		jQuery("#ebook figure img").click(function(){
			jQuery("#lightbox").css("background-image", "url('" + jQuery(this).attr("src") + "')");
			jQuery("#lightbox").show();
		});
		jQuery("#close").click(function(){
			jQuery("#lightbox").hide();
		});

	
		if (document.getElementById('scroll-wrap') != null ) {
		  setTimeout(function(){
		
			/* Get line height */
			var line_height = parseInt( jQuery("#ebook p").css("line-height") );
			
			/* Resize book images */
			jQuery("#ebook figure, #ebook h2").each(function() {
				box_height = parseInt( jQuery(this).height() ); 
				jQuery(this).height( (box_height - (box_height % line_height) + line_height).toString() + "px" ); 
			});
			
			/* Compute margin */
			margin = line_height;
			
			/* Get sticky bar and content box heights */
			sticky_bar_height = parseInt( jQuery("#sticky-bar > nav").height() );
			content_height = parseInt( jQuery("#ebook").height() );
			
			/* Compute scroll interval (16 is wrapper padding) */
			var box_height = jQuery(window).height() - sticky_bar_height - 16;
			scroll_interval = box_height - (box_height % line_height) - margin;
			
			if (content_height > scroll_interval) {
				
				/* Show buttons if not one page section */
				jQuery("#book-nav").fadeTo("slow",1);
			
				/* Calculate Max Clicks */
				max_clicks = Math.floor(content_height / scroll_interval);
			}
			
			/* Resize bounding box */
			jQuery('#scroll-wrap').height(scroll_interval + 'px');

			window.addEventListener("resize", function() {
				/* Reset when window resizes or screen orientation changes */
			}); 

			jQuery("#book-nav nav").click(function(){
			
				/* Get scroll direction */
				if (jQuery(this).hasClass("up")) { direction = "+"; anchor--; } else { direction = "-"; anchor++; }
				
				if (anchor >= 0) {
					if (anchor <= max_clicks) {
						jQuery("#ebook").animate({ top: direction + "=" + scroll_interval + "px" }, 700);
					} else {
						anchor = max_clicks;
					}
				} else {
					anchor = 0;
				}
				
			});
		  }, 300); /* close delay */
		} /* close if */
		
		
	});
		
}());
</script>